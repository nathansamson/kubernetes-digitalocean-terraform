coreos:
  units:
    - name: "docker-redis.service"
      command: "start"
      content: |
        [Unit]
        Description=haproxy service
        Author=Nathan Samson
        After=docker.service

        [Service]
        Restart=always
        ExecStartPre=-/usr/bin/docker kill haproxy
        ExecStartPre=-/usr/bin/docker rm haproxy
        ExecStartPre=/usr/bin/docker pull haproxy:1.6
        ExecStart=/usr/bin/docker run -p 80 -p 443 -p 2222 --name haproxy -v /opt/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg:ro haproxy:1.6
        ExecStop=/usr/bin/docker stop -t 2 haproxy

